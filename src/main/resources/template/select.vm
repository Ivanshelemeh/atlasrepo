#* @vtlvariable name="action" type="com.atlassian.shele.shelePlugin.webwork.SelectAction" *#



#set($context=$action.servletContext)
<html>
<head>
  <meta name="decorator" content="atl.admin"/>
  <meta name="admin.active.section" content="admin_plugins_menu/my-section"/>
  <meta name="admin.active.tab" content="my-next-item"/>
  <script src="https://connect-cdn.atl-paas.net/all.js"></script>
  <title>Okay bro!</title>
</head>
<body>
<form class="aui" action=$context.getAttribute("url")  method="post" id="form-1">
  <select class="multi-select" size="4" multiple="multiple" id="select2-example" multiple >
    <label>Projects</label>
      #foreach($pro in $context.getAttribute("prod"))
          #if($pro)
          <option id="opt" value=$pro.getId()>
                $pro.getKey()
          </option>
          #end
      #end
  </select>
  <div>

    <select class="multi-select" size="4" multiple="multiple" id="event" name="issue-example">
      <label>Events</label>
    #foreach($list in $context.getAttribute("event"))
      #if($list)
      <option id="test" value=$list.getId()>$list.getName()
      </option>
          #end
        #end
    </select>
  </div>
  <div class="bt-example">
    <button class="aui-button aui-button-primary" id="showAction" class="text-left" style="display: block; margin-right: auto;">Jira Loads..</button>
  </div>
</form>
<script type="text/javascript">
  AJS.toInit(function (){


    AJS.$('#form-1').submit(function (event) {
    AJS.$('#showAction').hide();
    event.preventDefault();
    var attr = $('#test').attr('value');
    console.log(attr);
    var attr2 = $('#test2').attr('value2');
    console.log(attr2);
      var attr3 = $('#test3').attr('value3');
      var attr4 = $('#test4').attr('value4');
      let arrs=[attr,attr2,attr3,attr4];
    var value = $('#form-1').attr('action');
    var host = value.valueOf();



      let sk=$('#select2-example').val();
        if (sk===null)
          alert('Project field can not be empty')
      //  window.location.reload();
          var g = $('#event').val();


    var a = {
      project: sk,
      eventTypeIds:g
    }
    console.log(a);

  var cancel =  jQuery.ajax({
      type: "POST",
      data: JSON.stringify(a),
      url: host,
      headers: { 'X-Atlassian-Token': 'nocheck'},
      dataType :"json",
      contentType:"application/json;charset=utf-8",
        success: function (){
          alert('Data success have been loaded success')
          AJS.$('#showAction').show();
        }

    }).done(function () {
      $('#event').trigger('reset');


    });
  });

  });
</script>
</body>
</html>